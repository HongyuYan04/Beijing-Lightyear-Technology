{"remainingRequest":"E:\\Java Program\\JP\\Program\\vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\Java Program\\JP\\Program\\vue\\src\\components\\CommonHeader.vue?vue&type=style&index=0&id=7f704488&lang=less&scoped=true","dependencies":[{"path":"E:\\Java Program\\JP\\Program\\vue\\src\\components\\CommonHeader.vue","mtime":1680769952000},{"path":"E:\\Java Program\\JP\\Program\\vue\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\Java Program\\JP\\Program\\vue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\Java Program\\JP\\Program\\vue\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\Java Program\\JP\\Program\\vue\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\Java Program\\JP\\Program\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\Java Program\\JP\\Program\\vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmhlYWRlciB7CiAgZGlzcGxheTogZmxleDsKICBoZWlnaHQ6IDEwMCU7CiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7Cn0KCi5sLWNvbnRlbnQgewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKCiAgLmVsLWJ1dHRvbiB7CiAgICBtYXJnaW4tcmlnaHQ6IDIwcHg7CiAgfQp9Cgouci1jb250ZW50IHsKICAuYXZhdGFyIHsKICAgIHdpZHRoOiA0MHB4OwogICAgaGVpZ2h0OiA0MHB4OwogICAgYm9yZGVyLXJhZGl1czogNTAlOwogIH0KfQoKLmNvbW1vbi10YWJsZSB7CiAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7CiAgcG9zaXRpb246IHJlbGF0aXZlOwp9Cg=="},{"version":3,"sources":["CommonHeader.vue"],"names":[],"mappings":";AAmcA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"CommonHeader.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <header>\n    <div class=\"l-content\">\n      <el-button\n        round\n        @click=\"collapseMenu\"\n        icon=\"el-icon-menu\"\n        type=\"info\"\n        size=\"mini\"\n      ></el-button>\n    </div>\n    <div class=\"r-content\">\n      <el-dropdown trigger=\"hover\" size=\"mini\" @command=\"handleCommand\">\n        <span>\n          <img :src=\"avatar\" alt=\"\" class=\"avatar\"/>\n        </span>\n        <el-dropdown-menu slot=\"dropdown\">\n          <el-dropdown-item command=\"showInfo\">个人信息</el-dropdown-item>\n          <el-dropdown-item command=\"editPwd\">修改密码</el-dropdown-item>\n          <el-dropdown-item command=\"leave\">请假</el-dropdown-item>\n          <el-dropdown-item command=\"logout\">退出</el-dropdown-item>\n        </el-dropdown-menu>\n      </el-dropdown>\n    </div>\n    <el-dialog\n      title=\"个人信息\"\n      :visible.sync=\"infoForm.isShow\"\n    >\n      <el-form ref=\"form\" label-width=\"100px\" :model=\"infoForm.formData\" size=\"mini\">\n        <el-form-item label-width=\"40px\" style=\"margin-bottom:4px \">\n          <el-form-item label=\"姓名\" style=\"display:inline-block;width:300px\" prop=\"name\">\n            <el-input\n              placeholder=\"请输入姓名\"\n              v-model.trim=\"infoForm.formData.name\"\n            />\n          </el-form-item>\n          <el-form-item label=\"生日\" style=\"display:inline-block\" prop=\"birthday\">\n            <el-date-picker\n              type=\"date\"\n              value-format=\"yyyy-MM-dd\"\n              placeholder=\"请选择生日\"\n              v-model=\"infoForm.formData.birthday\"\n            />\n          </el-form-item>\n        </el-form-item>\n        <el-form-item label-width=\"40px\" style=\"margin-bottom:4px \">\n          <el-form-item label=\"性别\" style=\"display:inline-block\" prop=\"gender\">\n            <el-select\n              placeholder=\"请选择员工性别\"\n              v-model=\"infoForm.formData.gender\"\n            >\n              <el-option\n                value=\"男\"\n              />\n              <el-option\n                value=\"女\"\n              />\n            </el-select>\n          </el-form-item>\n          <el-form-item label=\"电话\" style=\"display:inline-block\" prop=\"phone\">\n            <el-input\n              placeholder=\"请输入电话\"\n              v-model.trim=\"infoForm.formData.phone\"\n            />\n          </el-form-item>\n        </el-form-item>\n\n        <el-form-item label=\"地址\" label-width=\"140px\" style=\"width: 450px\" prop=\"address\">\n          <el-input\n            placeholder=\"请输入地址\"\n            v-model.trim=\"infoForm.formData.address\"\n          />\n        </el-form-item>\n\n        <el-form-item label=\"备注\" label-width=\"140px\" style=\"width:450px\" prop=\"remark\">\n          <el-input\n            type=\"textarea\"\n            placeholder=\"请输入\"\n            v-model.trim=\"infoForm.formData.remark\"\n            :autosize=\"{ minRows: 2, maxRows: 4}\"\n            maxlength=\"100\"\n            show-word-limit\n          />\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"infoForm.isShow = false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"confirmInfo\">确定</el-button>\n      </div>\n    </el-dialog>\n    <el-dialog\n      title=\"修改密码\"\n      :visible.sync=\"pwdForm.isShow\"\n    >\n      <el-form ref=\"pwdForm\" label-width=\"160px\" style=\"width: 85%\" :model=\"pwdForm.formData\" :rules=\"pwdForm.rules\"\n               size=\"mini\">\n        <el-form-item label=\"原密码\" prop=\"password\">\n          <el-input\n            placeholder=\"请输入原密码\"\n            v-model.trim=\"pwdForm.formData.password\"\n            prefix-icon=\"el-icon-lock\"\n            show-password\n          />\n        </el-form-item>\n        <el-form-item label=\"新密码\" prop=\"newPassword\">\n          <el-input\n            placeholder=\"请输入新密码\"\n            v-model.trim=\"pwdForm.formData.newPassword\"\n            prefix-icon=\"el-icon-lock\"\n            show-password\n          />\n        </el-form-item>\n        <el-form-item label=\"确认新密码\" prop=\"confirmPassword\">\n          <el-input\n            placeholder=\"请确认新密码\"\n            v-model.trim=\"pwdForm.formData.confirmPassword\"\n            prefix-icon=\"el-icon-lock\"\n            show-password\n          />\n        </el-form-item>\n      </el-form>\n\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"pwdForm.isShow = false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"confirmPwd\">确定</el-button>\n      </div>\n    </el-dialog>\n    <el-dialog title=\"请假\" :visible.sync=\"leaveForm.isShow\">\n      <el-tabs type=\"border-card\" value=\"leave\" @tab-click=\"clickTab\">\n        <el-tab-pane label=\"请假\" name=\"leave\">\n          <el-form ref=\"leaveForm\" label-width=\"100px\" size=\"mini\" :model=\"leaveForm.formData\"\n                   :rules=\"leaveForm.rules\">\n            <el-form-item label=\"假期类型\" prop=\"typeNum\">\n              <el-select v-model=\"leaveForm.formData.typeNum\" style=\"width:38%\">\n                <el-option v-for=\"(item,index) in leaveForm.leaveTypeList\" :key=\"index\" :value=\"item.typeNum\"\n                           :disabled=\"item.status === 0\"\n                           :label=\"item.typeNum\"/>\n              </el-select>\n            </el-form-item>\n            <el-form-item label=\"起始日期\" prop=\"startDate\">\n              <el-date-picker v-model=\"leaveForm.formData.startDate\" :pickerOptions=\"leaveForm.pickerOptions\"/>\n            </el-form-item>\n            <el-form-item label=\"请假天数\" prop=\"days\">\n              <el-input-number v-model=\"leaveForm.formData.days\" :min=\"1\" style=\"width:38%\" step-strictly/>\n            </el-form-item>\n            <el-form-item label=\"备注\">\n              <el-input type=\"textarea\" :autosize=\"{ minRows: 2, maxRows: 4}\"\n                        v-model.trim=\"leaveForm.formData.remark\"\n                        maxlength=\"100\"\n                        show-word-limit style=\"width:50%\"/>\n            </el-form-item>\n            <el-form-item>\n              <div style=\"text-align:center\">\n                <el-button @click=\"leaveForm.isShow = false\" style=\"margin-right:10px\">取消</el-button>\n                <el-button type=\"primary\" @click=\"applyLeave\" style=\"margin-left: 10px\">确定</el-button>\n              </div>\n            </el-form-item>\n          </el-form>\n        </el-tab-pane>\n        <el-tab-pane label=\"请假记录\" name=\"records\">\n          <div class=\"common-table\">\n            <el-table :data=\"table.tableData\" border\n                      height=\"240px\"\n                      stripe\n                      row-key=\"id\"\n                      :header-cell-style=\"{ background: '#eef1f6',color: '#606266',\n      textAlign:'center',fontWeight:'bold',borderWidth:'3px'}\">\n              <el-table-column label=\"类型\" prop=\"staffLeave.typeNum\" min-width=\"50px\" align=\"center\"/>\n              <el-table-column label=\"起始日期\" prop=\"staffLeave.startDate\" min-width=\"50px\" align=\"center\"/>\n              <el-table-column label=\"天数\" prop=\"staffLeave.days\" min-width=\"50px\" align=\"center\"/>\n              <el-table-column label=\"审核状态\" min-width=\"50px\" align=\"center\">\n                <template slot-scope=\"scope\">\n                  <el-tag :type=\"scope.row.tagType\">{{\n                      scope.row.staffLeave.status\n                    }}\n                  </el-tag>\n                </template>\n              </el-table-column>\n              <el-table-column label=\"备注\" prop=\"staffLeave.remark\" min-width=\"100px\" align=\"center\"/>\n              <el-table-column label=\"操作\" min-width=\"60px\" align=\"center\">\n                <template slot-scope=\"scope\">\n                  <el-button v-if=\"scope.row.staffLeave.status===scope.row.unaudited\" size=\"mini\" type=\"primary\"\n                             @click=\"cancel(scope.row)\"\n                  >撤销 <i class=\"el-icon-scissors\"></i\n                  ></el-button>\n                  <el-button v-if=\"scope.row.staffLeave.status!==scope.row.unaudited\" size=\"mini\" type=\"danger\"\n                             @click=\"handleDelete(scope.row)\"\n                  >删除 <i class=\"el-icon-brush\"></i\n                  ></el-button>\n                </template>\n              </el-table-column>\n            </el-table>\n            <el-pagination\n              style=\"margin-top: 10px;float: right\"\n              layout=\"total,sizes,prev,pager,next,jumper\"\n              :page-size=\"table.pageConfig.size ? table.pageConfig.size : 10\"\n              :page-sizes=\"[5, 10, 15, 20]\"\n              :total=\"table.pageConfig.total\"\n              :current-page.sync=\"table.pageConfig.current\"\n              @size-change=\"handleSizeChange\"\n              @current-change=\"handleCurrentChange\"\n            ></el-pagination>\n          </div>\n        </el-tab-pane>\n      </el-tabs>\n    </el-dialog>\n  </header>\n</template>\n<script>\nimport { checkPassword, edit, updatePassword } from '../api/staff'\nimport { getDownloadApi } from '../api/docs'\nimport { getLeaveBydeptId } from '../api/leave'\nimport { add, deleteOne, edit as editLeave, getListByStaffId, getUnauditedByStaffId } from '../api/staffLeave'\nimport { mapState } from 'vuex'\n\nexport default {\n  name: 'CommonHeader',\n  data () {\n    // 检查密码是否正确\n    const checkPwd = (rule, value, callback) => {\n      checkPassword(value, this.staff.id).then(\n        response => {\n          if (response.code === 200) {\n            callback()\n          } else {\n            callback(new Error('密码输入错误！'))\n          }\n        }\n      )\n    }\n    const checkNewPwd = (rule, value, callback) => {\n      if (value === this.pwdForm.formData.password) {\n        callback(new Error('不能使用近期的密码！'))\n      } else {\n        callback()\n      }\n    }\n    // 检查密码是否一致\n    const checkConfirmPwd = (rule, value, callback) => {\n      if (value !== this.pwdForm.formData.newPassword) {\n        callback(new Error('两次输入密码不一致!'))\n      } else {\n        callback()\n      }\n    }\n    const checkDays = (rule, value, callback) => {\n      const leaveType = this.leaveForm.leaveTypeList.find(item => item.typeId === this.leaveForm.formData.typeId)\n      if (value > leaveType.days) {\n        callback(new Error('部门规定，' + leaveType.typeNum + '休假天数不超过' + leaveType.days + '天!'))\n      } else {\n        callback()\n      }\n    }\n    return {\n      infoForm: {\n        isShow: false,\n        formData: {}\n      },\n      pwdForm: {\n        isShow: false,\n        formData: {},\n        rules: {\n          password: [\n            { required: true, message: '请输入原密码', trigger: 'blur' },\n            { min: 3, max: 10, message: '长度在3到10个字符', trigger: 'blur' },\n            { validator: checkPwd, trigger: 'blur' }\n          ],\n          newPassword: [\n            { required: true, message: '请输入新密码', trigger: 'blur' },\n            { min: 3, max: 10, message: '长度在3到10个字符', trigger: 'blur' },\n            { validator: checkNewPwd, trigger: 'blur' }\n          ],\n          confirmPassword: [\n            { required: true, message: '请确认新密码', trigger: 'blur' },\n            { min: 3, max: 10, message: '长度在3到10个字符', trigger: 'blur' },\n            { validator: checkConfirmPwd, trigger: 'blur' }\n          ]\n        }\n      },\n      leaveForm: {\n        isShow: false,\n        inline: false,\n        formData: {},\n        leaveTypeList: [],\n        pickerOptions: { // 不能选择今天之前的日期\n          disabledDate (time) {\n            return time.getTime() < Date.now() - 24 * 60 * 60 * 1000\n          }\n        },\n        rules: {\n          typeNum: [\n            { required: true, message: '请选择', trigger: 'change' }\n          ],\n          startDate: [\n            { required: true, message: '请选择开始日期', trigger: 'blur' }\n          ],\n          days: [\n            { required: true, message: '请输入请假天数', trigger: 'blur' },\n            { validator: checkDays, trigger: 'blur' }\n          ]\n        }\n      },\n      table: {\n        tableData: [],\n        pageConfig: {\n          total: 10, // 记录总数\n          current: 1, // 起始页\n          size: 10 // 每页展示的记录数\n        }\n      }\n    }\n  },\n  computed: {\n    ...mapState('staff', ['staff']),\n    downloadApi () {\n      return getDownloadApi()\n    },\n    avatar () {\n      return this.staff.avatar ? this.downloadApi + this.staff.avatar : require('../assets/images/avatar.png')\n    }\n  },\n  methods: {\n    handleDelete (row) {\n      deleteOne(row.staffLeave.id).then(response => {\n        if (response.code === 200) {\n          this.loading()\n          this.$message.success('删除成功')\n        } else {\n          this.$message.error('删除失败')\n        }\n      })\n    },\n    cancel (row) {\n      editLeave({ id: row.staffLeave.id, status: row.cancel }).then(response => {\n        if (response.code === 200) {\n          this.loading()\n          this.$message.success('撤销成功')\n        } else {\n          this.$message.error('撤销失败')\n        }\n      })\n    },\n    clickTab (obj) {\n      if (obj.name === 'records') {\n        this.loading()\n      }\n    },\n    // 请假\n    applyLeave () {\n      // 当有假期未被审核时，不得请假\n      getUnauditedByStaffId(this.staff.id).then(response => {\n        if (response.code === 200) {\n          this.$message.error('你有未被审批的休假申请，目前不能请假！')\n        } else {\n          this.$refs.leaveForm.validate(valid => {\n            if (valid) {\n              this.leaveForm.formData.staffId = this.staff.id\n              add(this.leaveForm.formData).then(response => {\n                if (response.code === 200) {\n                  this.$message.success('提交成功！')\n                } else {\n                  this.$message.error('提交失败')\n                }\n              })\n            } else {\n              return false\n            }\n          })\n        }\n      })\n    },\n    // 全局控制侧边栏的展开\n    collapseMenu () {\n      this.$bus.$emit('collapseMenu')\n    },\n    handleCommand (command) {\n      if (command === 'showInfo') {\n        this.infoForm.isShow = true\n        this.infoForm.formData = this.staff\n      } else if (command === 'editPwd') {\n        this.pwdForm.isShow = true\n      } else if (command === 'leave') {\n        this.leaveForm.isShow = true\n        this.getListByDeptId()\n      } else {\n        this.$message.success('退出登录成功！')\n        this.$store.dispatch('staff/logout')\n      }\n    },\n    getListByDeptId () {\n      getLeaveBydeptId(this.staff.deptId).then(response => {\n        if (response.code === 200) {\n          this.leaveForm.leaveTypeList = response.data\n        }\n      })\n    },\n    confirmInfo () {\n      edit(this.infoForm.formData).then((response) => {\n        if (response.code === 200) {\n          this.$store.commit('staff/SET_STAFF', this.infoForm.formData)\n          this.$message.success('修改成功！')\n          this.infoForm.isShow = false\n        } else {\n          this.$message.error('修改失败！')\n        }\n      })\n    },\n    confirmPwd () {\n      this.$refs.pwdForm.validate(valid => {\n        if (valid) {\n          updatePassword({ id: this.staff.id, password: this.pwdForm.formData.newPassword }).then(\n            response => {\n              if (response.code === 200) {\n                this.$message.success('密码修改成功，请重新登录！')\n                this.$store.dispatch('staff/logout')\n              } else {\n                this.$message.error('密码修改失败！')\n              }\n            }\n          )\n        } else {\n          return false\n        }\n      })\n    },\n    handleSizeChange (size) {\n      this.table.pageConfig.size = size\n      this.loading()\n    },\n    handleCurrentChange (current) {\n      this.table.pageConfig.current = current\n      this.loading()\n    },\n    loading () {\n      getListByStaffId({\n        current: this.table.pageConfig.current,\n        size: this.table.pageConfig.size,\n        id: this.staff.id\n      }).then(response => {\n        if (response.code === 200) {\n          this.table.tableData = response.data.list\n          this.table.pageConfig.total = response.data.total\n        } else {\n          this.$message.error(response.message)\n        }\n      })\n    }\n  }\n}\n</script>\n<style lang=\"less\" scoped>\nheader {\n  display: flex;\n  height: 100%;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.l-content {\n  display: flex;\n  align-items: center;\n\n  .el-button {\n    margin-right: 20px;\n  }\n}\n\n.r-content {\n  .avatar {\n    width: 40px;\n    height: 40px;\n    border-radius: 50%;\n  }\n}\n\n.common-table {\n  background-color: white;\n  position: relative;\n}\n</style>\n"]}]}